<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê—É–¥–∏–æ –≤ –¢–µ–∫—Å—Ç</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header>
  <h1>–ê—É–¥–∏–æ –≤ –¢–µ–∫—Å—Ç</h1>
</header>

<main>
  <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
  <section class="home-screen">
    <button class="main-button record-button" onclick="startRecording()">üéôÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å –∞—É–¥–∏–æ</button>
    <button class="main-button upload-button">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ</button>
    <h2>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</h2>
    <div class="history" id="history">
      <!-- –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ addToHistory() -->
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ -->
  <section class="record-screen">
    <h2>–ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ</h2>
    <div class="record-visualizer" id="visualizer">
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    </div>
    <button class="secondary-button stop-button" onclick="stopRecording()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    <button class="main-button convert-button" onclick="convertToText()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å</button>
    <button class="secondary-button delete-button" onclick="deleteCurrentRecording()" style="display: none;">–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    <!-- –ê—É–¥–∏–æ-–ø–ª–µ–µ—Ä –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
    <audio id="audioPlayer" controls style="display: none; margin-top: 20px;">
      Your browser does not support the audio element.
    </audio>
  </section>
</main>

<footer>
  <p>¬© 2024 –ê—É–¥–∏–æ –≤ –¢–µ–∫—Å—Ç</p>
</footer>

<script>
  function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        document.getElementById("visualizer").classList.add("recording");

        audioChunks = [];
        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
          audioUrl = URL.createObjectURL(audioBlob);
          const audioPlayer = document.getElementById("audioPlayer");
          audioPlayer.src = audioUrl;
          audioPlayer.style.display = 'block';
          document.querySelector(".delete-button").style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
        };
      });
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === "recording") {
      mediaRecorder.stop();
      document.getElementById("visualizer").classList.remove("recording");
    }
  }

  function convertToText() {
    // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç
    const transcribedText = "–≠—Ç–æ –ø—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∏–∑ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏.";

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
    addToHistory(transcribedText, audioUrl);

    // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä –∏ –æ—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –±–µ–∑ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
    clearCurrentRecording();
  }

  function clearCurrentRecording() {
    const audioPlayer = document.getElementById("audioPlayer");
    audioPlayer.style.display = 'none';
    audioPlayer.src = '';
    document.querySelector(".delete-button").style.display = 'none'; // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
    audioChunks = [];
    audioUrl = '';
    console.log("–¢–µ–∫—É—â–∞—è –∑–∞–ø–∏—Å—å –æ—á–∏—â–µ–Ω–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é");
  }

  function deleteCurrentRecording() {
    clearCurrentRecording();
    console.log("–¢–µ–∫—É—â–∞—è –∑–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞");
  }

  function addToHistory(text, audioUrl) {
    const historyContainer = document.getElementById("history");

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Å –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è
    const historyItem = document.createElement("div");
    historyItem.classList.add("history-item");
    historyItem.innerHTML = `
        <audio controls src="${audioUrl}"></audio>
        <button class="delete-history-button" onclick="deleteHistoryItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
        <p>${text}</p>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –Ω–∞—á–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏
    historyContainer.prepend(historyItem);
  }

  function deleteHistoryItem(button) {
    // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
    const historyItem = button.parentElement;
    historyItem.remove();
  }

</script>
</body>
</html>
